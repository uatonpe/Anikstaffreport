<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡§¶‡•à‡§®‡§ø‡§ï ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</title>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;600&display=swap" rel="stylesheet">
<style>
    :root {
        --primary-bg: #f0f2f5; --card-bg: #ffffff; --header-bg-start: #1B4F72; --header-bg-end: #5DADE2;
        --primary-text: #34495E; --secondary-text: #7F8C8D; --accent-color: #5DADE2; --submitted-color: #2ECC71;
        --pending-color: #F39C12; --border-color: #e5e7eb; --shadow-light: rgba(0,0,0,0.05);
        --role-ca-color: #3498DB; --role-fx-color: #9B59B6; --role-bm-color: #E74C3C; --role-ta-color: #16A085;
    }
    body { font-family: 'Inter', 'Noto Sans Devanagari', sans-serif; background: var(--primary-bg); margin: 0; padding: 0; color: var(--primary-text); }
    header { background: linear-gradient(90deg, var(--header-bg-start), var(--header-bg-end)); padding: 20px; color: white; text-align: center; font-size: 26px; font-weight: 700; position: sticky; top: 0; z-index: 1000; }
    .main-container { padding: 15px; }
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ddd; background: var(--card-bg); padding: 5px 15px; border-radius: 8px 8px 0 0; }
    .tab-button { padding: 10px 20px; cursor: pointer; border: none; background: transparent; font-size: 16px; font-weight: 600; color: var(--secondary-text); border-bottom: 3px solid transparent; }
    .tab-button.active { color: var(--header-bg-start); border-bottom-color: var(--header-bg-start); }
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .card { background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px var(--shadow-light); margin-bottom: 20px; }
    .filter-controls { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
    .filter-controls label { font-weight: 600; }
    .filter-controls input, .filter-controls button, .filter-controls select { border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 6px; font-size: 14px; }
    .filter-controls button { background-color: var(--header-bg-start); color: white; cursor: pointer; }
    .branch-tabs { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; border-top: 1px solid var(--border-color); padding-top: 20px; }
    .branch-tab { padding: 8px 18px; border-radius: 20px; background: #e9ecef; cursor: pointer; font-size: 14px; font-weight: 600; }
    .branch-tab.active { background: var(--accent-color); color: white; }
    .kpi-container, .role-kpi-grid { display: grid; gap: 20px; }
    .kpi-container { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
    .role-kpi-grid { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
    .kpi { padding: 20px; border-radius: 12px; display: flex; align-items: center; gap: 15px; border-left: 5px solid; cursor: pointer; }
    .kpi-icon { width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 50%; flex-shrink: 0; }
    .kpi-icon svg { width: 24px; height: 24px; }
    .kpi-content .kpi-value { font-size: 32px; font-weight: 700; }
    .role-kpi .kpi-value { font-size: 26px; }
    #totalStaff { border-color: var(--primary-text); } #totalStaff .kpi-icon { background-color: #e8f0fe; }
    #submittedReports { border-color: var(--submitted-color); } #submittedReports .kpi-icon { background-color: #e6f9f0; }
    #pendingReports { border-color: var(--pending-color); } #pendingReports .kpi-icon { background-color: #fff8e1; }
    #kpiCA { border-color: var(--role-ca-color); } #kpiCA .kpi-icon { background-color: rgba(52, 152, 219, 0.1); }
    #kpiFX { border-color: var(--role-fx-color); } #kpiFX .kpi-icon { background-color: rgba(155, 89, 182, 0.1); }
    #kpiBM { border-color: var(--role-bm-color); } #kpiBM .kpi-icon { background-color: rgba(231, 76, 60, 0.1); }
    #kpiTA { border-color: var(--role-ta-color); } #kpiTA .kpi-icon { background-color: rgba(22, 160, 133, 0.1); }
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
    .card h3 { margin-top: 0; border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-bottom: 15px; }
    .insights ul { padding-left: 20px; margin: 0; list-style-type: 'üëâ '; } .insights li { margin-bottom: 12px; line-height: 1.6; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
    th { background: #fafafa; }
    .clickable { color: #1B4F72; cursor: pointer; font-weight: bold; text-decoration: none; }
    .clickable:hover { text-decoration: underline; }
    .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
    .modal-content { background: white; margin: 5% auto; padding: 30px; border-radius: 12px; width: 80%; max-width: 700px; }
    .close { float: right; font-size: 28px; cursor: pointer; }
    #modalReportContent h4, #roleDetailsModal h3 { color: var(--header-bg-start); border-bottom: 1px solid #eee; padding-bottom: 10px; margin-top: 0; }
    #modalReportContent p { margin: 10px 0; line-height: 1.6; }
    #modalReportContent strong { color: var(--primary-text); min-width: 220px; display: inline-block; }
    #modalReportContent hr { border: none; border-top: 1px solid #eee; margin: 15px 0; }
    .role-details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
    .role-list-container h4 { margin-top: 0; border-bottom: 1px solid var(--border-color); padding-bottom: 8px; font-size: 16px; }
    .role-list-container ul { list-style: none; padding: 0; margin: 0; max-height: 300px; overflow-y: auto; }
    .role-list-container li { padding: 8px 5px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
</style>
</head>
<body>

<header>‡§¶‡•à‡§®‡§ø‡§ï ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</header>

<div class="main-container">
    <div class="tabs">
        <button class="tab-button active" onclick="openTab(event, 'Dashboard')">üìä ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</button>
        <button class="tab-button" onclick="openTab(event, 'Performance')">üèÜ ‡§ï‡§æ‡§Æ‡§ó‡§ø‡§∞‡•Ä ‡§Ö‡§π‡§µ‡§æ‡§≤</button>
    </div>

    <div id="Dashboard" class="tab-content active">
        <div class="card">
            <div class="filter-controls">
                <label>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</label> <input type="date" id="dashboardDate">
                <button onclick="processData()">‡§°‡•á‡§ü‡§æ ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂ ‡§ï‡§∞‡§æ</button>
            </div>
            <div class="branch-tabs" id="branchTabsContainer"><p>‡§∂‡§æ‡§ñ‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á‡§§...</p></div>
        </div>
        <div class="kpi-container">
            <div class="kpi" id="totalStaff"><div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg></div><div class="kpi-content"><div class="kpi-value" id="kpiTotal">0</div><div class="kpi-label">‡§è‡§ï‡•Ç‡§£ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä</div></div></div>
            <div class="kpi" id="submittedReports"><div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg></div><div class="kpi-content"><div class="kpi-value" id="kpiSubmitted">0</div><div class="kpi-label">‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§Ö‡§π‡§µ‡§æ‡§≤</div></div></div>
            <div class="kpi" id="pendingReports"><div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg></div><div class="kpi-content"><div class="kpi-value" id="kpiPending">0</div><div class="kpi-label">‡§™‡•ç‡§∞‡§≤‡§Ç‡§¨‡§ø‡§§ ‡§Ö‡§π‡§µ‡§æ‡§≤</div></div></div>
        </div>
        <div class="card" style="margin-top: 20px;">
            <h3>‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ-‡§®‡§ø‡§π‡§æ‡§Ø ‡§ï‡§æ‡§Æ‡§ó‡§ø‡§∞‡•Ä</h3>
            <div class="role-kpi-grid">
                <div class="kpi role-kpi" id="kpiCA" onclick="showRoleDetails('CA')"><div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm0-4H7V5h10v8z"/></svg></div><div class="kpi-content"><div class="kpi-value" id="kpiValueCA">0 / 0</div><div class="kpi-label">CA</div></div></div>
                <div class="kpi role-kpi" id="kpiFX" onclick="showRoleDetails('FX')"><div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15 17h2v-3h1v-2h-1v-1h2v-3h-2V7h-2v1h-1V7h-2v1h-1V7H9v1H8v3h2v1H8v2h1v3H7v-1h1v-2H7v-1H5v2h1v3h2v-1h1v1h2v-1h1v1h2zm-4-4h2v-1h-2v1z"/></svg></div><div class="kpi-content"><div class="kpi-value" id="kpiValueFX">0 / 0</div><div class="kpi-label">FX</div></div></div>
                <div class="kpi role-kpi" id="kpiBM" onclick="showRoleDetails('BM')"><div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zM10 4h4v2h-4V4zm10 15H4V8h16v11z"/></svg></div><div class="kpi-content"><div class="kpi-value" id="kpiValueBM">0 / 0</div><div class="kpi-label">BM</div></div></div>
                <div class="kpi role-kpi" id="kpiTA" onclick="showRoleDetails('TA')"><div class="kpi-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M13 2.05v3.03c3.39.49 6 3.39 6 6.92 0 .9-.18 1.75-.48 2.54l2.6 1.53c.56-1.24.88-2.62.88-4.07 0-5.18-3.95-9.45-9-9.95zM12 19c-3.87 0-7-3.13-7-7 0-3.53 2.61-6.43 6-6.92V2.05c-5.06.5-9 4.76-9 9.95 0 5.52 4.48 10 10 10s10-4.48 10-10c0-1.18-.21-2.31-.6-3.36l-2.67 1.54c.43.9.7 1.94.7 3.02 0 3.87-3.13 7-7 7z"/></svg></div><div class="kpi-content"><div class="kpi-value" id="kpiValueTA">0 / 0</div><div class="kpi-label">TA</div></div></div>
            </div>
        </div>
        <div class="dashboard-grid">
            <div class="card"><div id="piechart" style="width: 100%; height: 350px;"></div></div>
            <div class="card insights"><h3>üìà ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∏‡•Ç‡§ö‡§®‡§æ (Insights)</h3><ul id="branchInsights"><li>‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...</li></ul></div>
        </div>
        <div class="dashboard-grid">
            <div class="card"><h3>‚úÖ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§Ø‡§æ‡§¶‡•Ä</h3><table id="submittedList"><thead><tr><th>‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä</th><th>‡§Ö‡§π‡§µ‡§æ‡§≤</th></tr></thead><tbody></tbody></table></div>
            <div class="card"><h3>‚ùå ‡§™‡•ç‡§∞‡§≤‡§Ç‡§¨‡§ø‡§§ ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§Ø‡§æ‡§¶‡•Ä</h3><table id="pendingList"><thead><tr><th>‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä</th></tr></thead><tbody></tbody></table></div>
        </div>
    </div>

    <div id="Performance" class="tab-content">
        <div class="card">
            <h3>‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§ï‡§æ‡§Æ‡§ó‡§ø‡§∞‡•Ä ‡§Ö‡§π‡§µ‡§æ‡§≤</h3>
            <div class="filter-controls">
                <label>‡§Æ‡§π‡§ø‡§®‡§æ:</label> <input type="month" id="perfMonth">
                <label>‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ:</label> 
                <select id="perfRole">
                    <option value="ALL">‡§∏‡§∞‡•ç‡§µ ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ</option>
                    <option value="CA">CA</option>
                    <option value="FX">FX</option>
                    <option value="BM">BM</option>
                    <option value="TA">TA</option>
                </select>
                <button onclick="generatePerformanceReport()">‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ</button>
            </div>
            <div id="performanceReportContainer" style="margin-top: 20px; overflow-x: auto;"><p>‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§Æ‡§π‡§ø‡§®‡§æ ‡§Ü‡§£‡§ø ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§®‡§ø‡§µ‡§°‡§æ.</p></div>
        </div>
    </div>
</div>

<div id="reportModal" class="modal"><div class="modal-content"><span class="close" onclick="document.getElementById('reportModal').style.display='none'">&times;</span><h3>‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§§‡§™‡§∂‡•Ä‡§≤</h3><div id="modalReportContent"></div></div></div>
<div id="roleDetailsModal" class="modal"><div class="modal-content"><span class="close" onclick="document.getElementById('roleDetailsModal').style.display='none'">&times;</span><h3 id="roleModalTitle">‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§§‡§™‡§∂‡•Ä‡§≤</h3><div class="role-details-grid"><div class="role-list-container"><h4>‚úÖ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡•á‡§≤‡•á‡§≤‡•á</h4><ul id="roleSubmittedList"></ul></div><div class="role-list-container"><h4>‚ùå ‡§™‡•ç‡§∞‡§≤‡§Ç‡§¨‡§ø‡§§</h4><ul id="rolePendingList"></ul></div></div></div></div>

<script>
    const API_KEY = "AIzaSyCib9D8dkRRV7MyGDfTcCqaubl19RnCdhQ";
    const SHEET_ID = "1or7yTCZLhu1qdTijEBC--9lHsigVb3yy1nY-qByHIGY";
    const STAFF_SHEET = "StaffList";
    const REPORTS_SHEET = "Reports";

    const appState = { allStaff: [], allReports: [], viewableReports: [], currentBranch: "ALL", dataLoaded: false };
    
    document.getElementById('dashboardDate').valueAsDate = new Date();
    
    function openTab(evt, tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = "none");
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove("active"));
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.classList.add("active");
        if (tabName === 'Performance' && !document.getElementById('perfMonth').value) {
            document.getElementById('perfMonth').value = new Date().toISOString().slice(0, 7);
        }
    }
    
    async function loadDashboard() {
        if (appState.dataLoaded) { processData(); return; }
        document.querySelector('header').innerText = '‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...';
        try {
            const staffPromise = fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${STAFF_SHEET}?key=${API_KEY}`);
            const reportPromise = fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${REPORTS_SHEET}?key=${API_KEY}`);
            const [staffRes, reportRes] = await Promise.all([staffPromise, reportPromise]);
            
            if (!staffRes.ok) throw new Error(`Staff list API call failed.`);
            if (!reportRes.ok) throw new Error(`Reports list API call failed.`);

            const staffData = await staffRes.json();
            const reportData = await reportRes.json();

            appState.allStaff = (staffData.values || []).slice(1).filter(row => row && row.length > 0 && row[0]);
            appState.allReports = (reportData.values || []).slice(1).filter(row => row && row.length > 0 && row[1]);
            
            appState.dataLoaded = true;
            populateBranchTabs();
            processData();
            document.querySelector('header').innerText = '‡§¶‡•à‡§®‡§ø‡§ï ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°';
        } catch (error) {
            console.error("Error loading data:", error);
            alert("‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ö‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä! \n1. ‡§§‡•Å‡§Æ‡§ö‡•Ä API Key ‡§¨‡§∞‡•ã‡§¨‡§∞ ‡§Ü‡§π‡•á ‡§ï‡§æ ‡§§‡•á ‡§§‡§™‡§æ‡§∏‡§æ.\n2. ‡§ó‡•Ç‡§ó‡§≤ ‡§∂‡•Ä‡§ü‡§ö‡•ç‡§Ø‡§æ 'Share' ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§ú 'Anyone with the link can view' ‡§Ü‡§π‡•á‡§§ ‡§ï‡§æ ‡§§‡•á ‡§§‡§™‡§æ‡§∏‡§æ.\n3. ‡§ï‡§®‡•ç‡§∏‡•ã‡§≤ (Inspect > Console) ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§§‡§™‡§æ‡§∏‡§æ.");
            document.querySelector('header').innerText = '‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ö‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä';
        }
    }
    
    function populateBranchTabs() {
        const branches = [...new Set(appState.allStaff.map(s => s[1]).filter(Boolean))];
        const tabsContainer = document.getElementById('branchTabsContainer');
        tabsContainer.innerHTML = '<div class="branch-tab active" onclick="changeBranch(\'ALL\', this)">‡§∏‡§∞‡•ç‡§µ ‡§∂‡§æ‡§ñ‡§æ</div>' +
            branches.map(b => `<div class="branch-tab" onclick="changeBranch('${b.toUpperCase()}', this)">${b}</div>`).join('');
    }

    function changeBranch(branch, element) {
        appState.currentBranch = branch.toUpperCase();
        document.querySelectorAll('.branch-tab').forEach(tab => tab.classList.remove('active'));
        element.classList.add('active');
        processData();
    }
    
    function processData() {
        if (!appState.dataLoaded) return;
        
        const date = new Date(document.getElementById('dashboardDate').value).toLocaleDateString('en-GB', { timeZone: 'Asia/Kolkata' });
        const filteredStaff = appState.currentBranch === "ALL" 
            ? appState.allStaff 
            : appState.allStaff.filter(s => s[1] && s[1].toUpperCase() === appState.currentBranch);
        
        const submittedReports = appState.allReports.filter(r => r[1] === date && (appState.currentBranch === "ALL" || (r[3] && r[3].toUpperCase() === appState.currentBranch)));
        const submittedNames = submittedReports.map(r => r[2]);
        const pendingStaff = filteredStaff.filter(s => !submittedNames.includes(s[0]));
        
        appState.viewableReports = submittedReports.map(r => createReportObject(r));

        updateKPIs(filteredStaff.length, submittedReports.length, pendingStaff.length);
        updateRoleKPIs(filteredStaff, submittedNames);
        drawPieChart(submittedReports.length, pendingStaff.length);
        populateLists(submittedReports, pendingStaff);
        generateInsights(submittedReports, pendingStaff);
    }

    function updateKPIs(total, submitted, pending) {
        document.getElementById('kpiTotal').innerText = total;
        document.getElementById('kpiSubmitted').innerText = submitted;
        document.getElementById('kpiPending').innerText = pending;
    }

    function updateRoleKPIs(filteredStaff, submittedNames) {
        const roles = ['CA', 'FX', 'BM', 'TA'];
        roles.forEach(role => {
            const staffInRole = filteredStaff.filter(s => s[2] === role);
            const submittedInRole = staffInRole.filter(s => submittedNames.includes(s[0]));
            const kpiValueEl = document.getElementById(`kpiValue${role}`);
            if (kpiValueEl) kpiValueEl.innerText = `${submittedInRole.length} / ${staffInRole.length}`;
        });
    }

    function populateLists(submittedReports, pendingStaff) {
        const submittedBody = document.querySelector('#submittedList tbody');
        submittedBody.innerHTML = submittedReports.length === 0
            ? `<tr><td colspan="2" style="text-align:center;">‡§Ü‡§ú ‡§ï‡•ã‡§£‡•Ä‡§π‡•Ä ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡•á‡§≤‡•á‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä.</td></tr>`
            : submittedReports.map((r, index) => `<tr><td>${r[2]}</td><td><span class="clickable" onclick="viewReportByIndex(${index})">‡§µ‡§æ‡§ö‡§æ</span></td></tr>`).join('');

        const pendingBody = document.querySelector('#pendingList tbody');
        pendingBody.innerHTML = pendingStaff.length === 0
            ? `<tr><td style="text-align:center;">‡§ï‡•ã‡§£‡•Ä‡§π‡•Ä ‡§™‡•ç‡§∞‡§≤‡§Ç‡§¨‡§ø‡§§ ‡§®‡§æ‡§π‡•Ä.</td></tr>`
            : pendingStaff.map(staff => `<tr><td>${staff[0]}</td></tr>`).join('');
    }
    
    function generateInsights(submittedReports, pendingStaff) {
        const insightsList = document.getElementById('branchInsights');
        insightsList.innerHTML = '<li>‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§•‡§æ‡§Ç‡§¨‡§æ...</li>';
        if (!appState.dataLoaded) return;
        
        insightsList.innerHTML = '';
        if (submittedReports.length === 0 && pendingStaff.length > 0) {
            insightsList.innerHTML = `<li>‡§Ü‡§ú ‡§Ö‡§¶‡•ç‡§Ø‡§æ‡§™ ‡§è‡§ï‡§π‡•Ä ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ù‡§æ‡§≤‡•á‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä.</li>`;
            return;
        }

        const reportsData = submittedReports.map(r => createReportObject(r));
        let totalCollection = 0, totalDisbursement = 0, totalMeetings = 0, totalAppraisals = 0;

        if(reportsData && reportsData.length > 0) {
            reportsData.forEach(r => {
                if (r) { 
                    if (r.role === 'CA') totalMeetings += Number(r.ca_meeting_count) || 0;
                    if (r.role === 'FX') totalAppraisals += Number(r.fx_appraisal_count) || 0;
                    if (r.role === 'BM') totalDisbursement += Number(r.bm_disburse_amt) || 0;
                    totalCollection += (Number(r.ca_reg_amt) || 0) + (Number(r.ca_odpast_amt) || 0) + (Number(r.fx_pastdue_amt) || 0) + (Number(r.bm_coll_total) || 0);
                }
            });
        }

        insightsList.innerHTML += `<li><strong>‡§è‡§ï‡•Ç‡§£ ‡§ï‡§≤‡•á‡§ï‡•ç‡§∂‡§®:</strong> ${totalCollection.toLocaleString('en-IN')} ‡§∞‡•Å.</li>`;
        if (totalDisbursement > 0) insightsList.innerHTML += `<li><strong>‡§è‡§ï‡•Ç‡§£ ‡§µ‡§æ‡§ü‡§™:</strong> ${totalDisbursement.toLocaleString('en-IN')} ‡§∞‡•Å.</li>`;
        if (totalMeetings > 0) insightsList.innerHTML += `<li><strong>‡§è‡§ï‡•Ç‡§£ ‡§ó‡§ü ‡§¨‡•à‡§†‡§ï‡§æ:</strong> ${totalMeetings}</li>`;
        if (totalAppraisals > 0) insightsList.innerHTML += `<li><strong>‡§è‡§ï‡•Ç‡§£ ‡§Ö‡•Ö‡§™‡•ç‡§∞‡•ã‡§Ø‡§ù‡§≤:</strong> ${totalAppraisals}</li>`;
        if (pendingStaff.length > 0) insightsList.innerHTML += `<li><strong>‡§™‡•ç‡§∞‡§≤‡§Ç‡§¨‡§ø‡§§ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä:</strong> ${pendingStaff.length} ‡§ú‡§£.</li>`;
        else if (submittedReports.length > 0) {
             insightsList.innerHTML += `<li><strong>‡§â‡§§‡•ç‡§§‡§Æ!</strong> ‡§∏‡§∞‡•ç‡§µ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§±‡•ç‡§Ø‡§æ‡§Ç‡§®‡•Ä ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡•á‡§≤‡§æ ‡§Ü‡§π‡•á.</li>`;
        }
    }

    function drawPieChart(submitted, pending) {
        const data = google.visualization.arrayToDataTable([['‡§∏‡•ç‡§•‡§ø‡§§‡•Ä', '‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ'], ['‡§∏‡§¨‡§Æ‡§ø‡§ü', submitted], ['‡§™‡•ç‡§∞‡§≤‡§Ç‡§¨‡§ø‡§§', pending]]);
        const options = { title: '‡§Ü‡§ú‡§ö‡•Ä ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä', pieHole: 0.5, colors: ['#2ECC71', '#F39C12'], legend: { position: 'bottom' }, fontName: 'Inter' };
        const chart = new google.visualization.PieChart(document.getElementById('piechart'));
        chart.draw(data, options);
    }

    function createReportObject(row) {
        if (!row || row.length < 37) return null;
        return {
            date: row[1], name: row[2], leave: row[4], role: row[5],
            ca_reg_count: row[6], ca_reg_amt: row[7], ca_odpast_count: row[8], ca_odpast_amt: row[9], ca_meeting_village: row[10], ca_meeting_count: row[11], ca_member_selection: row[12], ca_forms_filled: row[13],
            fx_appraisal_count: row[14], fx_appraisal_villages: row[15], fx_recovery_help: row[16], fx_pastdue_count: row[17], fx_pastdue_amt: row[18],
            bm_disburse_village: row[19], bm_disburse_members: row[20], bm_disburse_amt: row[21], bm_coll_regular: row[22], bm_coll_pastdue: row[23], bm_coll_od: row[24], bm_coll_total: row[25], bm_appr_approved: row[26], bm_appr_rejected: row[27], bm_reject_reason: row[28], bm_investment_amt: row[29],
            ta_analysis_reports: row[30], ta_coll_match: row[31], ta_match_reason: row[32], ta_finance_update: row[33], ta_spmb_update: row[34], ta_recovery_tracker: row[35],
            notes: row[36]
        };
    }
    
    function viewReportByIndex(index, sourceArray = appState.viewableReports) {
        const data = sourceArray[index];
        if (!data) return;
        displayReportModal(data);
    }
    
    function displayReportModal(data) {
        const modalContent = document.getElementById('modalReportContent');
        let html = '';
        if (data.leave === '‡§π‡•ã‡§Ø') { html = '<h4>‡§∏‡•ç‡§•‡§ø‡§§‡•Ä: ‡§∞‡§ú‡§æ</h4>'; } 
        else {
            switch(data.role) {
                case 'CA': html = `<h4>CA ‡§Ö‡§π‡§µ‡§æ‡§≤</h4><p><strong>‡§∞‡•á‡§ó‡•ç‡§Ø‡•Å‡§≤‡§∞ ‡§ï‡§≤‡•á‡§ï‡•ç‡§∂‡§®:</strong> ${data.ca_reg_count || 0} ‡§ñ‡§æ‡§§‡•Ä, ${data.ca_reg_amt || 0} ‡§∞‡•Å.</p><p><strong>‡§ì‡§°‡•Ä/‡§™‡§æ‡§∏‡•ç‡§ü‡§°‡§Ø‡•Å ‡§ï‡§≤‡•á‡§ï‡•ç‡§∂‡§®:</strong> ${data.ca_odpast_count || 0} ‡§ñ‡§æ‡§§‡•Ä, ${data.ca_odpast_amt || 0} ‡§∞‡•Å.</p><p><strong>‡§ó‡§ü ‡§¨‡•à‡§†‡§ï ‡§ó‡§æ‡§µ:</strong> ${data.ca_meeting_village || 'N/A'}</p><p><strong>‡§¨‡•à‡§†‡§ï‡§æ‡§Ç‡§ö‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ:</strong> ${data.ca_meeting_count || 0}</p><p><strong>‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°:</strong> ${data.ca_member_selection || 0}</p><p><strong>‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡§≤‡•á:</strong> ${data.ca_forms_filled || 0}</p><p><strong>‡§µ‡§ø‡§∂‡•á‡§∑ ‡§®‡•ã‡§Ç‡§¶‡•Ä:</strong> ${data.notes || '‡§ï‡§æ‡§π‡•Ä ‡§®‡§æ‡§π‡•Ä'}</p>`; break;
                case 'FX': html = `<h4>FX ‡§Ö‡§π‡§µ‡§æ‡§≤</h4><p><strong>‡§Ö‡•Ö‡§™‡•ç‡§∞‡•ã‡§Ø‡§ù‡§≤ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ:</strong> ${data.fx_appraisal_count || 0}</p><p><strong>‡§Ö‡•Ö‡§™‡•ç‡§∞‡•ã‡§Ø‡§ù‡§≤ ‡§ó‡§æ‡§µ‡•á:</strong> ${data.fx_appraisal_villages || 'N/A'}</p><p><strong>‡§∞‡§ø‡§ï‡§µ‡§∞‡•Ä ‡§Æ‡§¶‡§§:</strong> ${data.fx_recovery_help || 'N/A'}</p><p><strong>‡§™‡§æ‡§∏‡•ç‡§ü ‡§°‡§Ø‡•Å ‡§ï‡§≤‡•á‡§ï‡•ç‡§∂‡§®:</strong> ${data.fx_pastdue_count || 0} ‡§ñ‡§æ‡§§‡•Ä, ${data.fx_pastdue_amt || 0} ‡§∞‡•Å.</p><p><strong>‡§µ‡§ø‡§∂‡•á‡§∑ ‡§®‡•ã‡§Ç‡§¶‡•Ä:</strong> ${data.notes || '‡§ï‡§æ‡§π‡•Ä ‡§®‡§æ‡§π‡•Ä'}</p>`; break;
                case 'BM': html = `<h4>BM ‡§Ö‡§π‡§µ‡§æ‡§≤</h4><p><strong>‡§≤‡•ã‡§® ‡§µ‡§æ‡§ü‡§™ ‡§ó‡§æ‡§µ:</strong> ${data.bm_disburse_village || 'N/A'}</p><p><strong>‡§Æ‡•á‡§Ç‡§¨‡§∞‡§ö‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ:</strong> ${data.bm_disburse_members || 0}</p><p><strong>‡§µ‡§æ‡§ü‡§™ ‡§∞‡§ï‡•ç‡§ï‡§Æ:</strong> ${data.bm_disburse_amt || 0} ‡§∞‡•Å.</p><hr><p><strong>‡§è‡§ï‡•Ç‡§£ ‡§ï‡§≤‡•á‡§ï‡•ç‡§∂‡§®:</strong> ${data.bm_coll_total || 0} ‡§∞‡•Å. (‡§∞‡•á‡§ó‡•ç‡§Ø‡•Å‡§≤‡§∞: ${data.bm_coll_regular || 0}, ‡§™‡§æ‡§∏‡•ç‡§ü ‡§°‡§Ø‡•Å: ${data.bm_coll_pastdue || 0}, ‡§ì‡§°‡•Ä: ${data.bm_coll_od || 0})</p><hr><p><strong>‡§Ö‡•Ö‡§™‡•ç‡§∞‡§æ‡§Ø‡§ù‡§≤ ‡§Æ‡§Ç‡§ú‡•Ç‡§∞:</strong> ${data.bm_appr_approved || 0}</p><p><strong>‡§Ö‡•Ö‡§™‡•ç‡§∞‡§æ‡§Ø‡§ù‡§≤ ‡§∞‡§¶‡•ç‡§¶:</strong> ${data.bm_appr_rejected || 0}</p><p><strong>‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§ö‡•á ‡§ï‡§æ‡§∞‡§£:</strong> ${data.bm_reject_reason || 'N/A'}</p><p><strong>‡§ó‡•Å‡§Ç‡§§‡§µ‡§£‡•Ç‡§ï ‡§∞‡§ï‡•ç‡§ï‡§Æ:</strong> ${data.bm_investment_amt || 0} ‡§∞‡•Å.</p><p><strong>‡§µ‡§ø‡§∂‡•á‡§∑ ‡§®‡•ã‡§Ç‡§¶‡•Ä:</strong> ${data.notes || '‡§ï‡§æ‡§π‡•Ä ‡§®‡§æ‡§π‡•Ä'}</p>`; break;
                case 'TA': html = `<h4>TA ‡§Ö‡§π‡§µ‡§æ‡§≤</h4><p><strong>‡§Ö‡•Ö‡§®‡§æ‡§≤‡§ø‡§∏‡•Ä‡§∏ ‡§∞‡§ø‡§∞‡•ç‡§™‡§æ‡§ü:</strong> ${data.ta_analysis_reports || 0}</p><p><strong>‡§ï‡§≤‡•á‡§ï‡•ç‡§∂‡§® ‡§Æ‡•Ö‡§ö:</strong> ${data.ta_coll_match || 'N/A'}</p><p><strong>‡§® ‡§ú‡•Å‡§≥‡§£‡•ç‡§Ø‡§æ‡§ö‡•á ‡§ï‡§æ‡§∞‡§£:</strong> ${data.ta_coll_match === '‡§®‡§æ‡§π‡•Ä' ? (data.ta_match_reason || '‡§¶‡§ø‡§≤‡•á ‡§®‡§æ‡§π‡•Ä') : '‡§≤‡§æ‡§ó‡•Ç ‡§®‡§æ‡§π‡•Ä'}</p><p><strong>‡§´‡§æ‡§Ø‡§®‡§æ‡§®‡•ç‡§∏ ‡§∏‡§ø‡§∏‡•ç‡§ü‡•Ä‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü:</strong> ${data.ta_finance_update || 'N/A'}</p><p><strong>SPMB ‡§∏‡§ø‡§∏‡•ç‡§ü‡•Ä‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü:</strong> ${data.ta_spmb_update || 'N/A'}</p><p><strong>‡§∞‡§ø‡§ï‡§µ‡•ç‡§π‡§∞‡•Ä ‡§ü‡•ç‡§∞‡•Ö‡§ï‡§∞:</strong> ${data.ta_recovery_tracker || 'N/A'}</p><p><strong>‡§µ‡§ø‡§∂‡•á‡§∑ ‡§®‡•ã‡§Ç‡§¶‡•Ä:</strong> ${data.notes || '‡§ï‡§æ‡§π‡•Ä ‡§®‡§æ‡§π‡•Ä'}</p>`; break;
                default: html = `<h4>‡§á‡§§‡§∞ ‡§Ö‡§π‡§µ‡§æ‡§≤</h4><p><strong>‡§®‡•ã‡§Ç‡§¶‡•Ä:</strong> ${data.notes || '‡§ï‡§æ‡§π‡•Ä ‡§®‡§æ‡§π‡•Ä'}</p>`;
            }
        }
        modalContent.innerHTML = html;
        document.getElementById('reportModal').style.display = 'block';
    }

    function showRoleDetails(role) {
        const date = new Date(document.getElementById('dashboardDate').value).toLocaleDateString('en-GB', { timeZone: 'Asia/Kolkata' });
        const filteredStaff = appState.currentBranch === "ALL" 
            ? appState.allStaff.filter(s => s[2] === role)
            : appState.allStaff.filter(s => s[1] && s[1].toUpperCase() === appState.currentBranch && s[2] === role);
        const submittedReportsToday = appState.allReports.filter(r => r[1] === date);
        const submittedStaffReportsMap = new Map(submittedReportsToday.map(r => [r[2], createReportObject(r)])); 
        const submittedList = [];
        const pendingList = [];
        filteredStaff.forEach(staff => {
            const staffName = staff[0];
            if (submittedStaffReportsMap.has(staffName)) {
                submittedList.push(submittedStaffReportsMap.get(staffName));
            } else {
                pendingList.push({ name: staffName });
            }
        });
        const modal = document.getElementById('roleDetailsModal');
        document.getElementById('roleModalTitle').innerText = `${role} - ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä (${appState.currentBranch})`;
        const submittedUl = document.getElementById('roleSubmittedList');
        const pendingUl = document.getElementById('rolePendingList');
        submittedUl.innerHTML = submittedList.length > 0 
            ? submittedList.map((report) => `<li><span>${report.name}</span><span class="clickable" onclick='displayReportModal(${JSON.stringify(report)})'>‡§µ‡§æ‡§ö‡§æ</span></li>`).join('')
            : `<li>‡§ï‡•ã‡§£‡•Ä‡§π‡•Ä ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡•á‡§≤‡•á‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä.</li>`;
        pendingUl.innerHTML = pendingList.length > 0
            ? pendingList.map(p => `<li>${p.name}</li>`).join('')
            : `<li>‡§∏‡§∞‡•ç‡§µ ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ù‡§æ‡§≤‡•á ‡§Ü‡§π‡•á‡§§.</li>`;
        modal.style.display = 'block';
    }

    function generatePerformanceReport() {
        const monthInput = document.getElementById('perfMonth').value;
        const roleInput = document.getElementById('perfRole').value;
        if (!monthInput) { alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡§π‡§ø‡§®‡§æ ‡§®‡§ø‡§µ‡§°‡§æ."); return; }
        const [year, month] = monthInput.split('-');
        const filteredStaff = (roleInput === 'ALL') ? appState.allStaff : appState.allStaff.filter(s => s[2] === roleInput);
        const performanceData = {};
        filteredStaff.forEach(staff => {
            performanceData[staff[0]] = {
                role: staff[2], reportsSubmitted: 0,
                totalCollection_CA: 0, meetingsHeld: 0, membersSelected: 0, formsFilled: 0,
                appraisalsDone: 0, totalCollection_FX: 0,
                totalDisbursedAmt: 0, totalCollection_BM: 0, investmentAmt: 0, approvedAppr: 0,
            };
        });
        appState.allReports.forEach(row => {
            const r = createReportObject(row);
            if (!r) return;
            const dateParts = r.date.split('/');
            if (dateParts[2] === year && dateParts[1] === month && performanceData[r.name] && r.leave !== '‡§π‡•ã‡§Ø') {
                const data = performanceData[r.name];
                data.reportsSubmitted++;
                switch(r.role) {
                    case 'CA': data.totalCollection_CA += (Number(r.ca_reg_amt) || 0) + (Number(r.ca_odpast_amt) || 0); data.meetingsHeld += (Number(r.ca_meeting_count) || 0); data.membersSelected += (Number(r.ca_member_selection) || 0); data.formsFilled += (Number(r.ca_forms_filled) || 0); break;
                    case 'FX': data.appraisalsDone += (Number(r.fx_appraisal_count) || 0); data.totalCollection_FX += (Number(r.fx_pastdue_amt) || 0); break;
                    case 'BM': data.totalDisbursedAmt += (Number(r.bm_disburse_amt) || 0); data.totalCollection_BM += (Number(r.bm_coll_total) || 0); data.investmentAmt += (Number(r.bm_investment_amt) || 0); data.approvedAppr += (Number(r.bm_appr_approved) || 0); break;
                }
            }
        });
        let tableHTML = `<h4>${month}/${year} ‡§Æ‡§π‡§ø‡§®‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§Ö‡§π‡§µ‡§æ‡§≤ (${roleInput})</h4><table>`;
        if (roleInput === 'CA' || roleInput === 'ALL') {
            tableHTML += `<thead><tr><th>CA</th><th>‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡•Ä</th><th>‡§ï‡§≤‡•á‡§ï‡•ç‡§∂‡§®(‡§∞‡•Å)</th><th>‡§Æ‡•Ä‡§ü‡§ø‡§Ç‡§ó</th><th>‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°</th><th>‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡§≤‡•á</th></tr></thead><tbody>`;
            for (const name in performanceData) { const data = performanceData[name]; if (data.role === 'CA') { tableHTML += `<tr><td>${name}</td><td>${data.reportsSubmitted}</td><td>${data.totalCollection_CA.toFixed(0)}</td><td>${data.meetingsHeld}</td><td>${data.membersSelected}</td><td>${data.formsFilled}</td></tr>`; } }
            tableHTML += `</tbody>`;
        }
        if (roleInput === 'FX' || roleInput === 'ALL') {
             tableHTML += `<thead><tr><th>FX</th><th>‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡•Ä</th><th>‡§ï‡§≤‡•á‡§ï‡•ç‡§∂‡§®(‡§∞‡•Å)</th><th>‡§Ö‡•Ö‡§™‡•ç‡§∞‡•ã‡§Ø‡§ù‡§≤</th></tr></thead><tbody>`;
            for (const name in performanceData) { const data = performanceData[name]; if (data.role === 'FX') { tableHTML += `<tr><td>${name}</td><td>${data.reportsSubmitted}</td><td>${data.totalCollection_FX.toFixed(0)}</td><td>${data.appraisalsDone}</td></tr>`; } }
            tableHTML += `</tbody>`;
        }
        if (roleInput === 'BM' || roleInput === 'ALL') {
             tableHTML += `<thead><tr><th>BM</th><th>‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡•Ä</th><th>‡§ï‡§≤‡•á‡§ï‡•ç‡§∂‡§®(‡§∞‡•Å)</th><th>‡§µ‡§æ‡§ü‡§™(‡§∞‡•Å)</th><th>‡§ó‡•Å‡§Ç‡§§‡§µ‡§£‡•Ç‡§ï(‡§∞‡•Å)</th><th>‡§Æ‡§Ç‡§ú‡•Ç‡§∞ ‡§Ö‡•Ö‡§™‡•ç‡§∞‡•ã.</th></tr></thead><tbody>`;
            for (const name in performanceData) { const data = performanceData[name]; if (data.role === 'BM') { tableHTML += `<tr><td>${name}</td><td>${data.reportsSubmitted}</td><td>${data.totalCollection_BM.toFixed(0)}</td><td>${data.totalDisbursedAmt.toFixed(0)}</td><td>${data.investmentAmt.toFixed(0)}</td><td>${data.approvedAppr}</td></tr>`; } }
            tableHTML += `</tbody>`;
        }
        tableHTML += '</table>';
        document.getElementById('performanceReportContainer').innerHTML = tableHTML;
    }

    // --- INITIAL LOAD ---
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(loadDashboard);
</script>
</body>
</html>